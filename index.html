<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Owami's Library ‚Äî Dtech Collection</title>
<style>
  :root {
    /* DTECH X OWAMI THEME */
    --accent: #00d4ff;        /* Tech Blue */
    --accent-light: #2979ff;  /* Light Blue */
    --accent-dark: #00a2c7;   /* Darker Blue */
    --highlight: #ff007f;     /* Owami Pink */
    --highlight-glow: rgba(255, 0, 127, 0.4);
    --text: #e0e0e0;
    --text-light: #b0b0b0;
    --muted: #6e6e6e;
    --background: #0a0a0a;    /* Deep Black */
    --card-bg: #141414;       /* Dark Gray */
    --border: #333333;

    --ui-font: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  /* Force Dark Mode Default */
  body {
    background: var(--background);
    color: var(--text);
    font-family: var(--ui-font);
    line-height: 1.5;
    margin: 0;
    height: 100%;
  }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: var(--background); }
  ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

  .topbar {
    background: rgba(20, 20, 20, 0.85);
    backdrop-filter: blur(10px);
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 30;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  }

  .brand {
    font-weight: 700;
    font-size: 22px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 12px;
    letter-spacing: -0.5px;
  }

  .brand-icon {
    font-size: 24px;
    filter: drop-shadow(0 0 5px var(--accent));
  }

  .brand-text em {
    color: var(--highlight);
    font-style: normal;
    text-shadow: 0 0 10px var(--highlight-glow);
  }

  .dtech-badge {
    background: var(--accent);
    color: #000;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 8px;
    font-weight: 800;
    letter-spacing: 1px;
    text-transform: uppercase;
    vertical-align: middle;
    box-shadow: 0 0 10px rgba(0, 212, 255, 0.4);
  }

  .tabs {
    display: flex;
    gap: 8px;
    background: #1f1f1f;
    padding: 4px;
    border-radius: 12px;
    border: 1px solid var(--border);
  }

  .tab {
    padding: 8px 20px;
    border-radius: 8px;
    background: transparent;
    color: var(--text-light);
    cursor: pointer;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.3s ease;
  }

  .tab:hover { color: var(--text); }

  .tab.active {
    background: var(--accent-light);
    color: #fff;
    box-shadow: 0 0 15px rgba(41, 121, 255, 0.4);
  }

  .search-row {
    display: flex;
    gap: 12px;
    align-items: center;
    padding: 20px 24px;
    background: var(--card-bg);
    border-bottom: 1px solid var(--border);
  }

  #searchInput {
    padding: 12px 16px;
    border-radius: 10px;
    border: 1px solid var(--border);
    flex: 1;
    max-width: 500px;
    font-size: 15px;
    background: #000;
    color: var(--text);
    transition: all 0.3s ease;
  }

  #searchInput:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.2);
  }

  #genreFilter {
    padding: 12px 16px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #000;
    color: var(--text);
    font-size: 15px;
    min-width: 200px;
  }

  .layout {
    max-width: 1400px;
    margin: 24px auto;
    padding: 0 20px;
  }

  .stats {
    color: var(--muted);
    margin: 12px 0 20px;
    font-size: 14px;
    font-family: monospace;
  }

  .loading-progress {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
    padding: 15px;
    background: rgba(0, 212, 255, 0.05);
    border: 1px solid rgba(0, 212, 255, 0.2);
    border-radius: 8px;
  }

  .progress-bar {
    flex: 1;
    height: 6px;
    background: #333;
    border-radius: 4px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 4px;
    transition: width 0.3s ease;
    box-shadow: 0 0 10px var(--accent);
  }

  .progress-text {
    font-size: 13px;
    color: var(--accent);
    min-width: 120px;
    text-align: right;
    font-family: monospace;
  }

  /* SECTIONS */
  .section-title {
    color: var(--text);
    border-bottom: 1px solid var(--border);
    padding-bottom: 12px;
    font-size: 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 25px;
    letter-spacing: -0.5px;
  }

  /* Pink accent on section titles */
  .section-title span { color: var(--highlight); margin-left: auto; font-size: 14px; opacity: 0.8; font-weight: normal; }

  /* HOME */
  #homeSection { background: transparent; padding: 0; border: none; box-shadow: none; }

  .genre-section {
    margin-bottom: 30px;
    background: var(--card-bg);
    padding: 20px;
    border-radius: 16px;
    border: 1px solid var(--border);
  }

  .genre-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
  }

  .genre-title {
    font-size: 18px;
    color: var(--accent);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .genre-count {
    background: #333;
    color: var(--text-light);
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 12px;
    font-family: monospace;
  }

  .books-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
  }

  .book-card {
    background: #000;
    border-radius: 12px;
    padding: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    gap: 10px;
    min-height: 200px;
    transition: all 0.3s ease;
    border: 1px solid #222;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .book-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 212, 255, 0.15);
    border-color: var(--accent);
  }

  /* Highlight bar - Pink Gradient */
  .book-card:before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--highlight));
    opacity: 0.8;
  }

  .cover-wrap {
    height: 140px;
    border-radius: 8px;
    overflow: hidden;
    background: #111;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .cover-wrap img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.9;
    transition: opacity 0.3s;
  }

  .book-card:hover .cover-wrap img { opacity: 1; }

  .cover-placeholder {
    padding: 10px;
    text-align: center;
    font-weight: 700;
    color: #444;
    font-size: 12px;
    text-transform: uppercase;
  }

  .book-title {
    font-weight: 600;
    font-size: 14px;
    line-height: 1.4;
    color: var(--text);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .book-author {
    color: var(--muted);
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .book-genre {
    color: var(--accent);
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.8;
  }

  .card-row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: auto;
  }

  .btn {
    padding: 8px 12px;
    border-radius: 6px;
    border: none;
    background: var(--accent-light);
    color: #fff;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s ease;
    flex: 1;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .btn:hover {
    background: var(--accent);
    box-shadow: 0 0 10px var(--accent);
  }

  .small-btn {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #333;
    background: #111;
    color: var(--text-light);
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .small-btn:hover {
    background: #222;
    color: var(--highlight);
    border-color: var(--highlight);
    box-shadow: 0 0 8px var(--highlight-glow);
  }

  .load-more-btn, .load-more-genres-btn {
    background: #222;
    color: var(--text);
    border: 1px solid var(--border);
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    display: block;
    margin: 20px auto;
    transition: all 0.3s ease;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .load-more-btn:hover, .load-more-genres-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(0, 212, 255, 0.05);
  }

  /* CONTINUE / READ LATER */
  #continueSection, #readLaterSection, #favoritesSection {
    background: transparent;
    padding: 0;
    border: none;
    box-shadow: none;
  }

  .continue-grid, .readlater-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
  }

  .continue-card, .readlater-card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    gap: 15px;
    transition: all 0.3s ease;
    border: 1px solid var(--border);
    position: relative;
  }

  .continue-card { border-left: 3px solid var(--accent); }
  .readlater-card { border-top: 3px solid var(--highlight); }

  .continue-card:hover, .readlater-card:hover {
    transform: translateY(-3px);
    border-color: var(--accent-light);
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
  }

  .continue-title, .readlater-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    margin: 0;
  }

  .continue-date, .readlater-date {
    font-size: 11px;
    color: var(--accent);
    background: rgba(0, 212, 255, 0.1);
    padding: 2px 8px;
    border-radius: 4px;
    text-transform: uppercase;
  }

  .continue-author, .readlater-author {
    color: var(--muted);
    font-size: 13px;
  }

  .progress-info { color: var(--text-light); }
  .progress-bar { background: #333; }

  .continue-btn {
    background: var(--accent-light);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
  }

  .readlater-open {
    background: var(--highlight);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
  }
  .readlater-open:hover { background: #d6006c; box-shadow: 0 0 10px var(--highlight); }

  .remove-btn, .readlater-remove {
    background: transparent;
    color: var(--muted);
    border: 1px solid var(--border);
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
  }

  .remove-btn:hover, .readlater-remove:hover {
    color: #ff4444;
    border-color: #ff4444;
  }

  /* VALENTINE MODAL */
  .valentine-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
  }

  .valentine-card {
    background: #1a0a10; /* Very dark pinkish black */
    border: 2px solid var(--highlight);
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    max-width: 400px;
    box-shadow: 0 0 50px rgba(255, 0, 127, 0.3);
    animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  @keyframes popIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .v-title {
    font-size: 28px;
    color: var(--highlight);
    margin-bottom: 16px;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 0 0 10px var(--highlight-glow);
  }

  .v-msg {
    color: var(--text);
    font-size: 16px;
    line-height: 1.6;
    margin-bottom: 30px;
  }

  .v-btn {
    background: var(--highlight);
    color: white;
    border: none;
    padding: 12px 30px;
    border-radius: 50px;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 0 20px var(--highlight-glow);
  }
  .v-btn:hover { transform: scale(1.05); background: #ff3399; }

  /* Toast */
  .toast {
    background: var(--card-bg);
    color: var(--accent);
    border: 1px solid var(--accent);
    box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    position: fixed; bottom: 20px; right: 20px; padding: 10px 20px; border-radius: 8px; z-index: 1000;
  }

  /* Bottom Nav for Mobile */
  .bottom-nav {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(10, 10, 10, 0.95);
    backdrop-filter: blur(10px);
    border-top: 1px solid var(--border);
    padding: 10px 0 15px; /* Extra padding for bottom */
    z-index: 40;
    justify-content: space-around;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
  }

  .nav-item {
    text-align: center;
    font-size: 10px;
    color: var(--text-light);
    cursor: pointer;
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .nav-item-icon {
    font-size: 20px;
    margin-bottom: 2px;
    filter: grayscale(100%);
    transition: all 0.2s;
  }

  .nav-item.active {
    color: var(--accent);
  }

  .nav-item.active .nav-item-icon {
    filter: grayscale(0%);
    text-shadow: 0 0 10px var(--accent);
  }

  @media (max-width: 768px) {
    .topbar { flex-direction: row; } /* Keep logo left */
    .topbar .tabs { display: none; }
    .bottom-nav { display: flex; }
    .layout { margin-bottom: 90px; } /* Add space for bottom nav */
    .search-row { flex-direction: column; }
    .books-grid { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<!-- Top -->
<div class="topbar">
  <div class="brand">
    <span class="brand-icon">üìö</span>
    <div class="brand-text"><em>Owami's</em> Library <span class="dtech-badge">Dtech</span></div>
  </div>
  <div class="tabs" role="tablist" aria-label="Sections">
    <div class="tab active" id="tab-home">Home</div>
    <div class="tab" id="tab-continue">Continue</div>
    <div class="tab" id="tab-readlater">Read Later</div>
    <div class="tab" id="tab-favorites">Favorites</div>
  </div>
  <button id="themeToggle" class="small-btn" aria-label="Toggle Dark Mode" style="display:none">üåô</button>
</div>

<!-- Bottom Nav (Mobile) -->
<nav class="bottom-nav">
  <div class="nav-item active" id="nav-home">
    <span class="nav-item-icon">üè†</span>
    <span>Home</span>
  </div>
  <div class="nav-item" id="nav-continue">
    <span class="nav-item-icon">‚è±Ô∏è</span>
    <span>Continue</span>
  </div>
  <div class="nav-item" id="nav-readlater">
    <span class="nav-item-icon">üìå</span>
    <span>Saved</span>
  </div>
  <div class="nav-item" id="nav-favorites">
    <span class="nav-item-icon">‚ù§Ô∏è</span>
    <span>Favs</span>
  </div>
</nav>

<!-- search/filters -->
<div class="search-row">
  <input id="searchInput" placeholder="Search by title, author, or subject..." />
  <select id="genreFilter"><option value="">All Genres</option></select>
</div>

<!-- main content -->
<div class="layout" id="layout">
  <div id="homeSection">
    <h2 class="section-title">Browse Collection</h2>
    <div class="stats" id="stats">Loading books...</div>
    <div id="loadingProgress" class="loading-progress" style="display: none;">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="progress-text" id="progressText">Loading...</div>
    </div>
    <div id="homeContent"></div>
    <button id="loadMoreGenres" class="load-more-genres-btn" style="display:none">Load More Genres</button>
  </div>

  <div id="continueSection" style="display:none">
    <h2 class="section-title">Continue Reading</h2>
    <div id="continueList" class="continue-grid"></div>
    <div id="continueEmpty" class="empty-note" style="display:none">Nothing to continue ‚Äî open a book and it will appear here.</div>
  </div>

  <div id="readLaterSection" style="display:none">
    <h2 class="section-title">Read Later</h2>
    <div id="readLaterList" class="readlater-grid"></div>
    <div id="readLaterEmpty" class="empty-note" style="display:none">No saved books ‚Äî add some using the "Read Later" button on a book card.</div>
  </div>

  <div id="favoritesSection" style="display:none">
    <h2 class="section-title">Favorites</h2>
    <div id="favoritesList" class="readlater-grid"></div>
    <div id="favoritesEmpty" class="empty-note" style="display:none">No favorites ‚Äî click the heart icon on a book to save it here.</div>
  </div>
</div>

<!-- Valentine's Modal -->
<div id="valentineModal" class="valentine-modal" style="display:none">
  <div class="valentine-card">
    <div class="v-title">Happy Valentine's Day!</div>
    <div class="v-msg">
      To my amazing girlfriend Owami,<br><br>
      I built this library just for you, so you can escape into stories whenever you wish.
      I hope you love reading here as much as I love you.<br><br>
      Forever yours, <br><em>Dtech</em>
    </div>
    <button class="v-btn" onclick="closeValentine()">Enter Library</button>
  </div>
</div>

<script>
/* CONFIG */
const BOOKS_PER_GENRE = 10;
const GENRES_PER_LOAD = 5;
const GENRES_PER_FILTER = 40;
const CHUNK_SIZE = 5000;
const DB_NAME = 'GutenbergLibDB';
const DB_VERSION = 1;
const STORE_NAME = 'books';

/* STATE */
let books = [];
let genreDisplayCounts = {};
let genresToShow = GENRES_PER_LOAD;
let rawData = "";
let processedData = "";
let isProcessing = false;

/* UI refs */
const homeContent = document.getElementById('homeContent');
const statsEl = document.getElementById('stats');
const loadMoreGenresBtn = document.getElementById('loadMoreGenres');
const loadingProgress = document.getElementById('loadingProgress');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');

/* Dark Mode */
const themeToggle = document.getElementById('themeToggle');
const savedTheme = localStorage.getItem('theme');

if (savedTheme === 'dark') {
  document.body.classList.add('dark-mode');
  themeToggle.textContent = '‚òÄÔ∏è';
}

themeToggle.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  const isDark = document.body.classList.contains('dark-mode');
  themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
});

/* Tabs & Mobile Nav */
const tabHome = document.getElementById('tab-home');
const tabContinue = document.getElementById('tab-continue');
const tabReadLater = document.getElementById('tab-readlater');
const tabFavorites = document.getElementById('tab-favorites');

const navHome = document.getElementById('nav-home');
const navContinue = document.getElementById('nav-continue');
const navReadLater = document.getElementById('nav-readlater');
const navFavorites = document.getElementById('nav-favorites');

const homeSection = document.getElementById('homeSection');
const continueSection = document.getElementById('continueSection');
const readLaterSection = document.getElementById('readLaterSection');
const favoritesSection = document.getElementById('favoritesSection');

// Desktop Tabs
tabHome.addEventListener('click', () => switchTab('home'));
tabContinue.addEventListener('click', () => switchTab('continue'));
tabReadLater.addEventListener('click', () => switchTab('readlater'));
tabFavorites.addEventListener('click', () => switchTab('favorites'));

// Mobile Nav
navHome.addEventListener('click', () => switchTab('home'));
navContinue.addEventListener('click', () => switchTab('continue'));
navReadLater.addEventListener('click', () => switchTab('readlater'));
navFavorites.addEventListener('click', () => switchTab('favorites'));

function switchTab(id){
  // Update desktop tabs
  tabHome.classList.remove('active');
  tabContinue.classList.remove('active');
  tabReadLater.classList.remove('active');
  tabFavorites.classList.remove('active');

  // Update mobile nav
  navHome.classList.remove('active');
  navContinue.classList.remove('active');
  navReadLater.classList.remove('active');
  navFavorites.classList.remove('active');

  // Hide all sections
  homeSection.style.display = 'none';
  continueSection.style.display = 'none';
  readLaterSection.style.display = 'none';
  favoritesSection.style.display = 'none';

  // Activate correct tab/nav and section
  if (id==='home'){
    tabHome.classList.add('active');
    navHome.classList.add('active');
    homeSection.style.display='block';
  }
  if (id==='continue'){
    tabContinue.classList.add('active');
    navContinue.classList.add('active');
    continueSection.style.display='block';
    renderContinueList();
  }
  if (id==='readlater'){
    tabReadLater.classList.add('active');
    navReadLater.classList.add('active');
    readLaterSection.style.display='block';
    renderReadLaterList();
  }
  if (id==='favorites'){
    tabFavorites.classList.add('active');
    navFavorites.classList.add('active');
    favoritesSection.style.display='block';
    renderFavoritesList();
  }
}

/* load data.txt and parse */
window.addEventListener('load', () => {
  loadBooks(false);
  checkValentine();
});

/* Valentine's Logic */
function checkValentine() {
  const shown = localStorage.getItem('owami_valentine_shown');
  if (!shown) {
    document.getElementById('valentineModal').style.display = 'flex';
  }
}

function closeValentine() {
  const modal = document.getElementById('valentineModal');
  modal.style.transition = 'opacity 0.5s';
  modal.style.opacity = '0';
  setTimeout(() => {
    modal.style.display = 'none';
    localStorage.setItem('owami_valentine_shown', 'true');
  }, 500);
}

/* INDEXEDDB FUNCTIONS */
function openDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);
    request.onerror = event => reject('IndexedDB error: ' + event.target.error);
    request.onsuccess = event => resolve(event.target.result);
    request.onupgradeneeded = event => {
      const db = event.target.result;
      if (!db.objectStoreNames.contains(STORE_NAME)) {
        db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
      }
    };
  });
}

async function getAllBooksFromDB() {
  const db = await openDB();
  return new Promise((resolve, reject) => {
    const transaction = db.transaction([STORE_NAME], 'readonly');
    const store = transaction.objectStore(STORE_NAME);
    const request = store.getAll();
    request.onsuccess = event => resolve(event.target.result);
    request.onerror = event => reject('Error getting books from DB: ' + event.target.error);
  });
}

async function addBooksToDB(booksToAdd) {
  const db = await openDB();
  return new Promise((resolve, reject) => {
    const transaction = db.transaction([STORE_NAME], 'readwrite');
    const store = transaction.objectStore(STORE_NAME);
    // Clear existing to avoid duplicates if re-populating
    store.clear().onsuccess = () => {
      booksToAdd.forEach(book => store.add(book));
    };
    transaction.oncomplete = () => resolve();
    transaction.onerror = event => reject('Error adding books to DB: ' + event.target.error);
  });
}

async function loadBooks(forceRefresh = false){
  try {
    loadingProgress.style.display = 'flex';

    // 1. Try loading from IndexedDB first (unless forced refresh)
    if (!forceRefresh) {
      progressText.textContent = 'Checking local cache...';
      try {
        const cachedBooks = await getAllBooksFromDB();
        if (cachedBooks && cachedBooks.length > 0) {
          books = cachedBooks;
          loadingProgress.style.display = 'none';
          statsEl.innerHTML = `üìö ${books.length} books loaded from cache <button onclick="loadBooks(true)" class="small-btn" style="margin-left:10px">Refresh Data</button>`;
          renderHomePage();
          populateGenreFilter();

          // Show/hide load more genres button logic
          const genres = new Set(books.map(b => b.genre));
          if (genres.size > genresToShow) {
            loadMoreGenresBtn.style.display = 'block';
          } else {
            loadMoreGenresBtn.style.display = 'none';
          }
          return;
        }
      } catch (e) {
        console.warn('IndexedDB failed, falling back to network', e);
      }
    }

    // 2. Fetch data.txt
    progressText.textContent = 'Loading data file...';
    
    const r = await fetch('data.txt', {cache:'no-store'});
    if(!r.ok) throw new Error('Failed to fetch data.txt');
    
    const reader = r.body.getReader();
    const decoder = new TextDecoder();
    let receivedLength = 0;
    let chunks = [];
    
    while(true) {
      const {done, value} = await reader.read();
      if (done) break;
      
      chunks.push(value);
      receivedLength += value.length;
      
      // Update progress
      const progressPercent = Math.min(50, (receivedLength / (2 * 1024 * 1024)) * 50); // Assume 2MB file
      progressFill.style.width = `${progressPercent}%`;
      progressText.textContent = `Loading data... ${Math.round(progressPercent)}%`;
    }
    
    // Correctly join chunks
    let combined = new Uint8Array(receivedLength);
    let position = 0;
    for(let chunk of chunks) {
      combined.set(chunk, position);
      position += chunk.length;
    }
    rawData = decoder.decode(combined);

    progressFill.style.width = '50%';
    progressText.textContent = 'Processing data...';
    
    // Start processing data in chunks
    // Clear books array before processing if it was a refresh
    if (forceRefresh) books = [];
    processDataChunk(true); // pass true to indicate we should save to DB at end
  } catch(err){
    console.error('loadBooks', err);
    homeContent.innerHTML = '<div class="empty-note">Error loading data.txt ‚Äî open console.</div>';
    statsEl.textContent = 'üìö 0 books loaded';
    loadingProgress.style.display = 'none';
  }
}

/* Process data in chunks to avoid freezing */
function processDataChunk(saveToDB = false) {
  if (isProcessing) return;
  isProcessing = true;
  
  if (processedData === "") processedData = rawData;
  
  let chunkEnd = Math.min(CHUNK_SIZE, processedData.length);
  if (chunkEnd < processedData.length) {
    const lastNewline = processedData.lastIndexOf('\n', chunkEnd);
    if (lastNewline > 0) chunkEnd = lastNewline + 1;
  }

  const chunkToProcess = processedData.substring(0, chunkEnd);
  const remainingData = processedData.substring(chunkEnd);
  
  parseDataChunk(chunkToProcess, true);
  
  const progressPercent = 50 + (50 * (rawData.length - remainingData.length) / rawData.length);
  progressFill.style.width = `${progressPercent}%`;
  progressText.textContent = `Processing data... ${Math.round(progressPercent)}%`;
  
  if (remainingData.length > 0) {
    processedData = remainingData;
    setTimeout(() => {
      isProcessing = false;
      processDataChunk(saveToDB);
    }, 10);
  } else {
    loadingProgress.style.display = 'none';
    isProcessing = false;
    statsEl.innerHTML = `üìö ${books.length} books loaded ‚Ä¢ Use search/genre <button onclick="loadBooks(true)" class="small-btn" style="margin-left:10px">Refresh Data</button>`;

    if (saveToDB) {
      addBooksToDB(books).then(() => console.log('Books saved to DB')).catch(e => console.error(e));
    }
    
    const totalGenres = countGenresInData(rawData);
    if (totalGenres > genresToShow) {
      loadMoreGenresBtn.style.display = 'block';
    } else {
      loadMoreGenresBtn.style.display = 'none';
    }
  }
}

/* Parse a chunk of data.txt */
function parseDataChunk(chunk, append = false) {
  const lines = chunk.split(/\r?\n/);
  let currentGenre = '';
  let currentBook = null;
  const parsed = [];
  let bookCount = 0;
  let genreCount = 0;

  for (let raw of lines){
    const line = raw.trim();
    if (!line) continue;
    if (line.includes('üéØ GENRE:')) {
      const m = line.match(/üéØ\s*GENRE:\s*([^\(]+)/i);
      currentGenre = m ? m[1].trim() : currentGenre;
      genreCount++;
      if (genreCount > genresToShow) break;
      continue;
    }
    const bs = line.match(/^üìñ\s*BOOK\s*\d+\s*:\s*(.+)$/i);
    if (bs){
      if (currentBook) {
        parsed.push(currentBook);
        bookCount++;
        if (bookCount >= BOOKS_PER_GENRE * genresToShow) break;
      }
      currentBook = { genre: currentGenre, title: bs[1].trim() };
      continue;
    }
    if (!currentBook) continue;
    if (line.includes('üë§ Author:')) currentBook.author = line.split('üë§ Author:')[1].trim();
    else if (line.includes('üìù Text URL:')) currentBook.textUrl = line.split('üìù Text URL:')[1].trim();
    else if (line.includes('üñºÔ∏è  Cover:') || line.includes('üñºÔ∏è Cover:')) {
      const coverMatch = line.match(/üñºÔ∏è\s*Cover:\s*(.+)/i);
      if (coverMatch) currentBook.cover = coverMatch[1].trim();
    }
    else if (/^-{6,}/.test(line)){ 
      parsed.push(currentBook); 
      bookCount++;
      currentBook = null; 
      if (bookCount >= BOOKS_PER_GENRE * genresToShow) break;
    }
  }
  if (currentBook) parsed.push(currentBook);

  if (append) books = books.concat(parsed);
  else books = parsed;

  renderHomePage();
  populateGenreFilter();
  renderContinueList();
}

function countGenresInData(text) {
  const lines = text.split(/\r?\n/);
  let genreCount = 0;
  for (let raw of lines){
    if (raw.trim().includes('üéØ GENRE:')) genreCount++;
  }
  return genreCount;
}

loadMoreGenresBtn.addEventListener('click', () => {
  genresToShow += GENRES_PER_LOAD;
  processedData = rawData;
  books = [];
  processDataChunk(false);
});

function renderHomePage(list=books){
  homeContent.innerHTML = '';
  if (!list.length) { 
    homeContent.innerHTML = '<div class="empty-note">No books found.</div>'; 
    return; 
  }
  
  const booksByGenre = {};
  list.forEach(book => {
    if (!booksByGenre[book.genre]) booksByGenre[book.genre] = [];
    booksByGenre[book.genre].push(book);
  });
  
  Object.keys(booksByGenre).forEach(genre => {
    if (!genreDisplayCounts[genre]) genreDisplayCounts[genre] = BOOKS_PER_GENRE;
  });
  
  const sortedGenres = Object.keys(booksByGenre).sort((a, b) => booksByGenre[b].length - booksByGenre[a].length);
  
  sortedGenres.forEach(genre => {
    const genreBooks = booksByGenre[genre];
    const displayCount = genreDisplayCounts[genre];
    const booksToShow = genreBooks.slice(0, displayCount);
    
    const genreSection = document.createElement('div');
    genreSection.className = 'genre-section';
    
    const genreHeader = document.createElement('div');
    genreHeader.className = 'genre-header';
    
    const genreTitle = document.createElement('div');
    genreTitle.className = 'genre-title';
    genreTitle.innerHTML = `<span>${genre}</span>`;
    
    const genreCount = document.createElement('div');
    genreCount.className = 'genre-count';
    genreCount.textContent = `${booksToShow.length} of ${genreBooks.length} books`;
    
    genreHeader.appendChild(genreTitle);
    genreHeader.appendChild(genreCount);
    genreSection.appendChild(genreHeader);
    
    const booksGrid = document.createElement('div');
    booksGrid.className = 'books-grid';
    
    booksToShow.forEach(book => {
      const card = createBookCard(book);
      booksGrid.appendChild(card);
    });
    
    genreSection.appendChild(booksGrid);
    
    if (displayCount < genreBooks.length) {
      const loadMoreBtn = document.createElement('button');
      loadMoreBtn.className = 'load-more-btn';
      loadMoreBtn.textContent = `Load More (${genreBooks.length - displayCount} remaining)`;
      loadMoreBtn.addEventListener('click', () => {
        genreDisplayCounts[genre] += BOOKS_PER_GENRE;
        renderHomePage(list);
      });
      genreSection.appendChild(loadMoreBtn);
    }
    
    homeContent.appendChild(genreSection);
  });
}

function createBookCard(book) {
  const card = document.createElement('div'); 
  card.className='book-card';
  
  const coverWrap = document.createElement('div'); 
  coverWrap.className='cover-wrap';
  
  if (book.cover){
    const img = document.createElement('img'); 
    img.src = book.cover;
    img.alt = book.title;
    img.onload = ()=>{/* ok */};
    img.onerror = ()=>{ coverWrap.innerHTML = `<div class="cover-placeholder">${shortTitle(book.title)}</div>`; };
    coverWrap.appendChild(img);
  } else {
    coverWrap.innerHTML = `<div class="cover-placeholder">${shortTitle(book.title)}</div>`;
  }

  const title = document.createElement('div'); 
  title.className='book-title'; 
  title.textContent = book.title;
  
  const author = document.createElement('div'); 
  author.className='book-author'; 
  author.textContent = book.author || '';
  
  const genre = document.createElement('div'); 
  genre.className='book-genre'; 
  genre.textContent = book.genre || '';
  
  const row = document.createElement('div'); 
  row.className='card-row';

  const readBtn = document.createElement('button'); 
  readBtn.className='btn'; 
  readBtn.innerHTML = 'üìñ Read';
  readBtn.addEventListener('click', (e)=>{ e.stopPropagation(); openBook(book); });

  const rlBtn = document.createElement('button'); 
  rlBtn.className='small-btn'; 
  rlBtn.textContent = isInReadLater(book.textUrl) ? 'Remove' : 'Read Later';
  rlBtn.addEventListener('click', (e)=>{ e.stopPropagation(); toggleReadLater(book); rlBtn.textContent = isInReadLater(book.textUrl) ? 'Remove' : 'Read Later'; });

  const favBtn = document.createElement('button');
  favBtn.className='small-btn';
  favBtn.innerHTML = isInFavorites(book.textUrl) ? '‚ù§Ô∏è' : 'ü§ç';
  favBtn.addEventListener('click', (e)=>{
    e.stopPropagation();
    toggleFavorite(book);
    favBtn.innerHTML = isInFavorites(book.textUrl) ? '‚ù§Ô∏è' : 'ü§ç';
  });

  row.appendChild(readBtn); 
  row.appendChild(rlBtn);
  row.appendChild(favBtn);
  card.appendChild(coverWrap); 
  card.appendChild(title); 
  card.appendChild(author); 
  card.appendChild(genre); 
  card.appendChild(row);
  
  card.addEventListener('click', ()=> openBook(book));
  
  return card;
}

function shortTitle(t){
  if (!t) return 'No title';
  return t.split(' ').slice(0,3).join(' ');
}

function populateGenreFilter(){
  const sel = document.getElementById('genreFilter'); 
  sel.innerHTML = '<option value="">All Genres</option>';
  
  const genreCounts = {};
  books.forEach(book => {
    if (book.genre) genreCounts[book.genre] = (genreCounts[book.genre] || 0) + 1;
  });
  
  const sortedGenres = Object.keys(genreCounts).sort((a, b) => genreCounts[b] - genreCounts[a]);
  const topGenres = sortedGenres.slice(0, GENRES_PER_FILTER);
  
  topGenres.forEach(g => { 
    const o = document.createElement('option'); 
    o.value = g; 
    o.textContent = `${g} (${genreCounts[g]})`; 
    sel.appendChild(o); 
  });
}

let searchTimeout;
document.getElementById('searchInput').addEventListener('input', (e)=>{
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    const q = e.target.value.trim().toLowerCase();
    const genre = document.getElementById('genreFilter').value;
    
    if (q.length < 2 && !genre) {
      renderHomePage();
      return;
    }
    
    loadingProgress.style.display = 'flex';
    progressFill.style.width = '0%';
    progressText.textContent = 'Searching...';
    processSearch(q, genre);
  }, 300);
});

function processSearch(query, genreFilter) {
  const filtered = [];
  let processed = 0;
  const totalBooks = books.length;
  const chunkSize = 100;
  
  function processChunk() {
    const chunkEnd = Math.min(processed + chunkSize, totalBooks);
    
    for (let i = processed; i < chunkEnd; i++) {
      const book = books[i];
      const searchText = (book.title + ' ' + (book.author||'') + ' ' + (book.genre||'')).toLowerCase();
      
      if ((!query || searchText.includes(query)) && (!genreFilter || book.genre === genreFilter)) {
        filtered.push(book);
      }
    }
    
    processed = chunkEnd;
    const progressPercent = (processed / totalBooks) * 100;
    progressFill.style.width = `${progressPercent}%`;
    progressText.textContent = `Searching... ${Math.round(progressPercent)}%`;
    
    if (processed < totalBooks) {
      setTimeout(processChunk, 0);
    } else {
      loadingProgress.style.display = 'none';
      renderHomePage(filtered);
      statsEl.textContent = `üìö Found ${filtered.length} books matching your search`;
    }
  }
  processChunk();
}

document.getElementById('genreFilter').addEventListener('change', ()=> document.getElementById('searchInput').dispatchEvent(new Event('input')));

/* READ LATER */
function getReadLater(){ try{ return JSON.parse(localStorage.getItem('gutenberg:readlater')||'[]') }catch(e){ return [] } }
function saveReadLater(list){ localStorage.setItem('gutenberg:readlater', JSON.stringify(list)); }
function isInReadLater(url){ if(!url) return false; return getReadLater().some(i=>i.textUrl===url); }
function toggleReadLater(book){
  const list = getReadLater();
  const idx = list.findIndex(b=>b.textUrl===book.textUrl);
  if (idx === -1) { 
    list.unshift({
      title:book.title, author:book.author, textUrl:book.textUrl, cover:book.cover, addedDate: new Date().toISOString()
    }); 
    saveReadLater(list); showToast('Added to Read Later');
  }
  else { list.splice(idx,1); saveReadLater(list); showToast('Removed from Read Later'); }
  renderReadLaterList();
}

/* FAVORITES */
function getFavorites(){ try{ return JSON.parse(localStorage.getItem('gutenberg:favorites')||'[]') }catch(e){ return [] } }
function saveFavorites(list){ localStorage.setItem('gutenberg:favorites', JSON.stringify(list)); }
function isInFavorites(url){ if(!url) return false; return getFavorites().some(i=>i.textUrl===url); }
function toggleFavorite(book){
  const list = getFavorites();
  const idx = list.findIndex(b=>b.textUrl===book.textUrl);
  if (idx === -1) {
    list.unshift({
      title:book.title, author:book.author, textUrl:book.textUrl, cover:book.cover, addedDate: new Date().toISOString()
    });
    saveFavorites(list); showToast('Added to Favorites');
  }
  else { list.splice(idx,1); saveFavorites(list); showToast('Removed from Favorites'); }
  if (document.getElementById('tab-favorites').classList.contains('active')) renderFavoritesList();
}

function renderFavoritesList(){
  const wrap = document.getElementById('favoritesList');
  const empty = document.getElementById('favoritesEmpty');
  const list = getFavorites();
  wrap.innerHTML=''; empty.style.display='none';
  if (!list.length){ empty.style.display='block'; return; }
  list.forEach(b=>{
    const card = document.createElement('div'); card.className = 'readlater-card';
    const coverWrap = document.createElement('div'); coverWrap.className = 'readlater-cover';
    if (b.cover){
      const img = document.createElement('img'); img.src = b.cover;
      img.onerror = () => { coverWrap.innerHTML = `<div class="cover-placeholder">${shortTitle(b.title)}</div>`; };
      coverWrap.appendChild(img);
    } else { coverWrap.innerHTML = `<div class="cover-placeholder">${shortTitle(b.title)}</div>`; }
    const info = document.createElement('div'); info.className = 'readlater-info';
    const title = document.createElement('div'); title.className = 'readlater-title'; title.textContent = b.title;
    const author = document.createElement('div'); author.className = 'readlater-author'; author.textContent = b.author || '';
    const date = document.createElement('div'); date.className = 'readlater-date'; date.textContent = `Added: ${formatDate(b.addedDate)}`;
    info.appendChild(title); info.appendChild(author); info.appendChild(date);
    const actions = document.createElement('div'); actions.className = 'readlater-actions';
    const openBtn = document.createElement('button'); openBtn.className = 'readlater-open'; openBtn.textContent = 'Open';
    openBtn.addEventListener('click', () => openBook(b));
    const removeBtn = document.createElement('button'); removeBtn.className = 'readlater-remove'; removeBtn.textContent = 'Remove';
    removeBtn.addEventListener('click', () => { toggleFavorite(b); });
    actions.appendChild(openBtn); actions.appendChild(removeBtn);
    card.appendChild(coverWrap); card.appendChild(info); card.appendChild(actions);
    wrap.appendChild(card);
  });
}

function renderReadLaterList(){
  const wrap = document.getElementById('readLaterList');
  const empty = document.getElementById('readLaterEmpty');
  const list = getReadLater();
  wrap.innerHTML=''; empty.style.display='none';
  if (!list.length){ empty.style.display='block'; return; }
  list.forEach(b=>{
    const card = document.createElement('div'); card.className = 'readlater-card';
    const coverWrap = document.createElement('div'); coverWrap.className = 'readlater-cover';
    if (b.cover){ 
      const img = document.createElement('img'); img.src = b.cover;
      img.onerror = () => { coverWrap.innerHTML = `<div class="cover-placeholder">${shortTitle(b.title)}</div>`; };
      coverWrap.appendChild(img); 
    } else { coverWrap.innerHTML = `<div class="cover-placeholder">${shortTitle(b.title)}</div>`; }
    const info = document.createElement('div'); info.className = 'readlater-info';
    const title = document.createElement('div'); title.className = 'readlater-title'; title.textContent = b.title;
    const author = document.createElement('div'); author.className = 'readlater-author'; author.textContent = b.author || '';
    const date = document.createElement('div'); date.className = 'readlater-date'; date.textContent = `Added: ${formatDate(b.addedDate)}`;
    info.appendChild(title); info.appendChild(author); info.appendChild(date);
    const actions = document.createElement('div'); actions.className = 'readlater-actions';
    const openBtn = document.createElement('button'); openBtn.className = 'readlater-open'; openBtn.textContent = 'Open';
    openBtn.addEventListener('click', () => openBook(b));
    const removeBtn = document.createElement('button'); removeBtn.className = 'readlater-remove'; removeBtn.textContent = 'Remove';
    removeBtn.addEventListener('click', () => { toggleReadLater(b); renderReadLaterList(); });
    actions.appendChild(openBtn); actions.appendChild(removeBtn);
    card.appendChild(coverWrap); card.appendChild(info); card.appendChild(actions);
    wrap.appendChild(card);
  });
}

/* CONTINUE READING */
function getContinueList(){
  const list=[];
  for (let i=0;i<localStorage.length;i++){
    const key = localStorage.key(i);
    if (!key) continue;
    if (key.startsWith('gutenberg:lastpage:')) {
      const url = key.replace('gutenberg:lastpage:','');
      const idx = parseInt(localStorage.getItem(key),10) || 0;
      const lastRead = localStorage.getItem('gutenberg:lastread:' + url) || '';
      let meta = books.find(b=>b.textUrl===url) || getReadLater().find(b=>b.textUrl===url) || null;
      if (meta) {
        list.push({
          title:meta.title, author:meta.author, textUrl:url, lastPage:idx, lastRead: lastRead,
          totalPages: parseInt(localStorage.getItem('gutenberg:totalpages:' + url) || '1', 10)
        });
      } else {
        list.push({
          title:url.split('/').slice(-1)[0], author:'', textUrl:url, lastPage:idx, lastRead: lastRead,
          totalPages: parseInt(localStorage.getItem('gutenberg:totalpages:' + url) || '1', 10)
        });
      }
    }
  }
  return list.sort((a, b) => new Date(b.lastRead) - new Date(a.lastRead));
}

function renderContinueList(){
  const wrap = document.getElementById('continueList');
  const empty = document.getElementById('continueEmpty');
  const list = getContinueList();
  wrap.innerHTML=''; empty.style.display='none';
  if (!list.length){ empty.style.display='block'; return; }
  list.forEach(item=>{
    const card = document.createElement('div'); card.className = 'continue-card';
    const header = document.createElement('div'); header.className = 'continue-header';
    const title = document.createElement('div'); title.className = 'continue-title'; title.textContent = item.title;
    const date = document.createElement('div'); date.className = 'continue-date'; date.textContent = item.lastRead ? formatDate(item.lastRead) : 'Unknown';
    header.appendChild(title); header.appendChild(date);
    const author = document.createElement('div'); author.className = 'continue-author'; author.textContent = item.author || '';
    const progressContainer = document.createElement('div'); progressContainer.className = 'progress-container';
    const progressInfo = document.createElement('div'); progressInfo.className = 'progress-info';
    progressInfo.innerHTML = `<span>Page ${item.lastPage + 1} of ${item.totalPages}</span><span>${Math.round((item.lastPage / item.totalPages) * 100)}%</span>`;
    const progressBar = document.createElement('div'); progressBar.className = 'progress-bar';
    const progressFill = document.createElement('div'); progressFill.className = 'progress-fill';
    progressFill.style.width = `${(item.lastPage / item.totalPages) * 100}%`;
    progressBar.appendChild(progressFill); progressContainer.appendChild(progressInfo); progressContainer.appendChild(progressBar);
    const actions = document.createElement('div'); actions.className = 'continue-actions';
    const continueBtn = document.createElement('button'); continueBtn.className = 'continue-btn'; continueBtn.textContent = 'Continue';
    continueBtn.addEventListener('click', () => openBook({title:item.title, textUrl:item.textUrl}));
    const removeBtn = document.createElement('button'); removeBtn.className = 'remove-btn'; removeBtn.textContent = 'Remove';
    removeBtn.addEventListener('click', () => { 
      localStorage.removeItem('gutenberg:lastpage:' + item.textUrl);
      localStorage.removeItem('gutenberg:lastread:' + item.textUrl);
      localStorage.removeItem('gutenberg:totalpages:' + item.textUrl);
      renderContinueList(); 
    });
    actions.appendChild(continueBtn); actions.appendChild(removeBtn);
    card.appendChild(header); card.appendChild(author); card.appendChild(progressContainer); card.appendChild(actions);
    wrap.appendChild(card);
  });
}

function formatDate(dateString) {
  if (!dateString) return 'Unknown';
  const date = new Date(dateString);
  const now = new Date();
  const diffTime = Math.abs(now - date);
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
  if (diffDays === 0) return 'Today';
  else if (diffDays === 1) return 'Yesterday';
  else if (diffDays < 7) return `${diffDays} days ago`;
  else return date.toLocaleDateString();
}

/* OPEN BOOK - REDIRECT TO READER.HTML */
function openBook(book){
  const b = (typeof book === 'string') ? books.find(x=>x.textUrl===book) : book;
  if (!b || !b.textUrl) { alert('No text URL'); return; }

  // Construct URL
  const params = new URLSearchParams();
  params.append('url', b.textUrl);
  params.append('title', b.title);
  params.append('author', b.author || '');
  if (b.cover) params.append('cover', b.cover);

  // Use location.href for same-tab navigation
  window.location.href = 'reader.html?' + params.toString();
}

function escapeHtml(s){ return (s||'').toString().replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function showToast(text){
  const t = document.createElement('div'); t.textContent = text; t.className = 'toast';
  document.body.appendChild(t); setTimeout(()=>t.remove(), 2000);
}

/* render both lists initially */
renderContinueList();
renderReadLaterList();

</script>
</body>
</html>
